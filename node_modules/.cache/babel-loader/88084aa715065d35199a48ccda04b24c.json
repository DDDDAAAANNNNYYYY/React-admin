{"ast":null,"code":"import \"antd/es/card/style/css\";\nimport _Card from \"antd/es/card\";\nimport \"antd/es/modal/style/css\";\nimport _Modal from \"antd/es/modal\";\nimport \"antd/es/table/style/css\";\nimport _Table from \"antd/es/table\";\nimport \"antd/es/space/style/css\";\nimport _Space from \"antd/es/space\";\nimport \"antd/es/button/style/css\";\nimport _Button from \"antd/es/button\";\nimport \"antd/es/message/style/css\";\nimport _message from \"antd/es/message\";\nvar _jsxFileName = \"/Users/danyangliu/Downloads/React-admin/src/pages/category/index.jsx\";\nimport React, { Component } from \"react\";\nimport { PlusOutlined, ArrowRightOutlined } from \"@ant-design/icons\";\nimport LinkButton from \"../../component/link-button\";\nimport { reqCategorys, reqUpdateCategory, reqAddCategory } from \"../../api/index\";\nimport AddForm from \"./addform\";\nimport UpdateForm from \"./updateform\";\nimport { withRouter } from 'react-router-dom';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nclass Category extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      categorys: [],\n      subCategorys: [],\n      //二级分类列表\n      loading: false,\n      parentId: \"0\",\n      //当前需要显示的分类ID\n      parentName: \"\",\n      //当前需要显示的分类名称\n      showStatus: 0 //0都不显示,1显示更新,2显示添加\n\n    };\n\n    this.getCategorys = async () => {\n      this.setState({\n        loading: true\n      });\n      const {\n        parentId\n      } = this.state;\n      const result = await reqCategorys(parentId);\n      this.setState({\n        loading: false\n      });\n\n      if (result.status === 0) {\n        //去除分类数组\n        const categorys = result.data;\n\n        if (parentId === \"0\") {\n          this.setState({\n            categorys\n          });\n        } else {\n          this.setState({\n            subCategorys: categorys\n          });\n        } // console.log(categorys)\n\n      } else {\n        _message.error(\"获取分类列表失败\");\n      }\n    };\n\n    this.showSubCategory = category => {\n      //更新状态时异步的\n      this.setState({\n        parentId: category._id,\n        parentName: category.name\n      }, () => {\n        //在状态更新后重新render后执行\n        this.getCategorys();\n      });\n    };\n\n    this.addCategotry = async () => {\n      this.setState({\n        showStatus: 0\n      }); //发请求更新分类\n      // console.log(this.classes);\n      // console.log(this.input);\n\n      const parentId = this.classes.props.value; // console.log(categoryId)\n\n      const categoryName = this.input.props.value;\n\n      if (!categoryName) {\n        _message.error('名称不能为空!');\n\n        return;\n      } //  console.log(categoryName)\n\n\n      const result = await reqAddCategory(categoryName, parentId); // console.log(result);\n\n      if (result.status === 0) {\n        //重新显示列表\n        // console.log('parentid',parentId)\n        if (!parentId) {\n          this.getCategorys(); //重新获取当前分类列表\n\n          _message.success('添加成功');\n        }\n      } else {\n        _message.error('添加失败');\n      }\n    };\n\n    this.updateCategory = async () => {\n      //\n      this.setState({\n        showStatus: 0\n      }); //发请求更新分类\n\n      const categoryId = this.category._id; // console.log(categoryId)\n\n      const categoryName = this.form.state.value;\n\n      if (!categoryName) {\n        _message.error('名称不能为空!');\n\n        return;\n      } // console.log(categoryName);\n\n\n      const result = await reqUpdateCategory(categoryId, categoryName); // console.log(result)\n\n      if (result.status === 200) {\n        //重新显示列表\n        this.getCategorys();\n\n        _message.success('修改成功');\n      } else {\n        _message.error('修改失败');\n      }\n    };\n\n    this.handleCancel = () => {\n      this.setState({\n        showStatus: 0\n      });\n    };\n  }\n\n  /* 准备数据 */\n  componentWillMount() {\n    // this.setState({parentId:'0'})\n    // reqCategorys,reqUpdateCategory,reqAddCategory,\n    this.columns = [{\n      title: \"分类名称\",\n      dataIndex: \"name\",\n      key: \"name\"\n    }, {\n      title: \"操作\",\n      width: 300,\n      key: \"action\",\n      dataIndex: \"\",\n      render: category => /*#__PURE__*/_jsxDEV(\"span\", {\n        children: [/*#__PURE__*/_jsxDEV(LinkButton, {\n          onClick: () => {\n            this.category = category;\n            this.setState({\n              showStatus: 2\n            });\n          },\n          children: \"\\u4FEE\\u6539\\u5206\\u7C7B\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 124,\n          columnNumber: 13\n        }, this), \" \", this.state.parentId === \"0\" ? /*#__PURE__*/_jsxDEV(LinkButton, {\n          onClick: () => {\n            this.showSubCategory(category);\n          },\n          children: \"\\u67E5\\u770B\\u5B50\\u5206\\u7C7B\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 134,\n          columnNumber: 15\n        }, this) : null]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 123,\n        columnNumber: 11\n      }, this)\n    }];\n  }\n\n  /* 执行异步任务 */\n  componentDidMount() {\n    this.getCategorys();\n  }\n\n  render() {\n    //card左侧\n    // console.log(this.props)\n    //card右侧\n    const extra = /*#__PURE__*/_jsxDEV(_Button, {\n      icon: /*#__PURE__*/_jsxDEV(PlusOutlined, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 161,\n        columnNumber: 15\n      }, this),\n      type: \"primary\",\n      onClick: () => {\n        this.setState({\n          showStatus: 1\n        });\n      },\n      children: \"\\u6DFB\\u52A0\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 160,\n      columnNumber: 7\n    }, this);\n\n    const {\n      parentId,\n      categorys,\n      subCategorys,\n      parentName,\n      showStatus\n    } = this.state;\n    const category = this.category || {}; // 如果还没有,则空对象\n\n    const title = parentId === \"0\" ? \"一级分类列表\" : /*#__PURE__*/_jsxDEV(_Space, {\n      children: [/*#__PURE__*/_jsxDEV(LinkButton, {\n        onClick: () => {\n          this.setState({\n            parentId: \"0\",\n            parentName: \"\",\n            subCategorys: []\n          }, () => {\n            //在状态更新后重新render后执行\n            this.getCategorys();\n          });\n        },\n        children: \"\\u4E00\\u7EA7\\u5206\\u7C7B\\u5217\\u8868\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 184,\n        columnNumber: 11\n      }, this), \" \", /*#__PURE__*/_jsxDEV(ArrowRightOutlined, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 201,\n        columnNumber: 11\n      }, this), \" \", parentName]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 183,\n      columnNumber: 9\n    }, this); // {console.log(this.columns)}\n\n    return /*#__PURE__*/_jsxDEV(_Card, {\n      title: title,\n      extra: extra,\n      children: [/*#__PURE__*/_jsxDEV(_Table, {\n        rowKey: \"_id\",\n        pagination: {\n          pageSize: 5 // , total: 50 \n\n        },\n        dataSource: parentId === \"0\" ? categorys : subCategorys,\n        columns: this.columns,\n        loading: this.state.loading\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 207,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(_Modal, {\n        title: \"\\u6DFB\\u52A0\\u5206\\u7C7B\",\n        visible: showStatus === 1,\n        onOk: this.addCategotry,\n        onCancel: this.handleCancel,\n        destroyOnClose: true,\n        children: /*#__PURE__*/_jsxDEV(AddForm, {\n          categorys: categorys,\n          categoryName: true,\n          setClasses: classes => {\n            this.classes = classes;\n          },\n          setInput: input => {\n            this.input = input;\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 223,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 216,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(_Modal, {\n        title: \"\\u4FEE\\u6539\\u5206\\u7C7B\",\n        visible: showStatus === 2,\n        onCancel: this.handleCancel,\n        destroyOnClose: true //让对话框关闭时候清空输入值\n        ,\n        onOk: this.updateCategory,\n        children: /*#__PURE__*/_jsxDEV(UpdateForm, {\n          category: category.name,\n          setForm: form => {\n            this.form = form;\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 241,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 234,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 206,\n      columnNumber: 7\n    }, this);\n  }\n\n}\n\nexport default _c = withRouter(Category);\n\nvar _c;\n\n$RefreshReg$(_c, \"%default%\");","map":{"version":3,"sources":["/Users/danyangliu/Downloads/React-admin/src/pages/category/index.jsx"],"names":["React","Component","PlusOutlined","ArrowRightOutlined","LinkButton","reqCategorys","reqUpdateCategory","reqAddCategory","AddForm","UpdateForm","withRouter","Category","state","categorys","subCategorys","loading","parentId","parentName","showStatus","getCategorys","setState","result","status","data","error","showSubCategory","category","_id","name","addCategotry","classes","props","value","categoryName","input","success","updateCategory","categoryId","form","handleCancel","componentWillMount","columns","title","dataIndex","key","width","render","componentDidMount","extra","pageSize"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { Modal } from \"antd\";\nimport { Space, Card, Table, Button, message } from \"antd\";\nimport { PlusOutlined, ArrowRightOutlined } from \"@ant-design/icons\";\nimport LinkButton from \"../../component/link-button\";\nimport {\n  reqCategorys,\n  reqUpdateCategory,\n  reqAddCategory,\n} from \"../../api/index\";\nimport AddForm from \"./addform\";\nimport UpdateForm from \"./updateform\";\nimport { withRouter } from 'react-router-dom'\n\nclass Category extends Component {\n  state = {\n    categorys: [],\n    subCategorys: [], //二级分类列表\n    loading: false,\n    parentId: \"0\", //当前需要显示的分类ID\n    parentName: \"\", //当前需要显示的分类名称\n    showStatus: 0, //0都不显示,1显示更新,2显示添加\n  };\n  /*\n  /* 異物获取一级或者耳机分类列表显示 */\n  getCategorys = async () => {\n    this.setState({ loading: true });\n    const { parentId } = this.state;\n    const result = await reqCategorys(parentId);\n    this.setState({ loading: false });\n    if (result.status === 0) {\n      //去除分类数组\n      const categorys = result.data;\n      if (parentId === \"0\") {\n        this.setState({ categorys });\n      } else {\n        this.setState({ subCategorys: categorys });\n      }\n      // console.log(categorys)\n    } else {\n      message.error(\"获取分类列表失败\");\n    }\n  };\n  /* 展现指定对象的子列表 */\n  showSubCategory = (category) => {\n    //更新状态时异步的\n    this.setState(\n      {\n        parentId: category._id,\n        parentName: category.name,\n      },\n      () => {\n        //在状态更新后重新render后执行\n        this.getCategorys();\n      }\n    );\n  };\n  addCategotry = async () => {\n    this.setState({ showStatus: 0 });\n    //发请求更新分类\n    // console.log(this.classes);\n    // console.log(this.input);\n    const parentId = this.classes.props.value;\n    // console.log(categoryId)\n    const categoryName = this.input.props.value;\n    if(!categoryName){\n      message.error('名称不能为空!')\n      return\n    }\n    //  console.log(categoryName)\n    const result = await reqAddCategory(categoryName, parentId);\n    // console.log(result);\n    if (result.status === 0) {\n      //重新显示列表\n      // console.log('parentid',parentId)\n      if(!parentId){\n        this.getCategorys();//重新获取当前分类列表\n        message.success('添加成功')\n      }\n    }else{\n      message.error('添加失败')\n    }\n  };\n  //修改后更新列表\n  updateCategory = async () => {\n    //\n    this.setState({ showStatus: 0 });\n    //发请求更新分类\n    const categoryId = this.category._id;\n    // console.log(categoryId)\n    const categoryName = this.form.state.value;\n    if(!categoryName){\n      message.error('名称不能为空!')\n      return\n    }\n    // console.log(categoryName);\n    const result = await reqUpdateCategory(categoryId, categoryName);\n    // console.log(result)\n    if (result.status === 200) {\n      //重新显示列表\n      this.getCategorys();\n      message.success('修改成功')\n    }else{\n      message.error('修改失败')\n    }\n  };\n  /* 准备数据 */\n  componentWillMount() {\n    // this.setState({parentId:'0'})\n    // reqCategorys,reqUpdateCategory,reqAddCategory,\n    this.columns = [\n      {\n        title: \"分类名称\",\n        dataIndex: \"name\",\n        key: \"name\",\n      },\n      {\n        title: \"操作\",\n        width: 300,\n        key: \"action\",\n        dataIndex: \"\",\n        render: (category) => (\n          <span>\n            <LinkButton\n              onClick={() => {\n                this.category = category;\n                this.setState({ showStatus: 2 });\n              }}\n            >\n              修改分类\n            </LinkButton>{\" \"}\n            {/* 如何向事件回调函数传递参数,定义一个回调函数 */}\n            {this.state.parentId === \"0\" ? (\n              <LinkButton\n                onClick={() => {\n                  this.showSubCategory(category);\n                }}\n              >\n                查看子分类\n              </LinkButton>\n            ) : null}\n          </span>\n        ),\n      },\n    ];\n  }\n\n  handleCancel = () => {\n    this.setState({ showStatus: 0 });\n  };\n  /* 执行异步任务 */\n  componentDidMount() {\n    this.getCategorys();\n  }\n  render() {\n    //card左侧\n    // console.log(this.props)\n    //card右侧\n    const extra = (\n      <Button\n        icon={<PlusOutlined />}\n        type=\"primary\"\n        onClick={() => {\n          this.setState({ showStatus: 1 });\n        }}\n      >\n        添加\n      </Button>\n    );\n    const {\n      parentId,\n      categorys,\n      subCategorys,\n      parentName,\n      showStatus,\n    } = this.state;\n\n    const category = this.category || {}; // 如果还没有,则空对象\n    const title =\n      parentId === \"0\" ? (\n        \"一级分类列表\"\n      ) : (\n        <Space>\n          <LinkButton\n            onClick={() => {\n              this.setState(\n                {\n                  parentId: \"0\",\n                  parentName: \"\",\n                  subCategorys: [],\n                },\n                () => {\n                  //在状态更新后重新render后执行\n                  this.getCategorys();\n                }\n              );\n            }}\n          >\n            一级分类列表\n          </LinkButton>{\" \"}\n          <ArrowRightOutlined /> {parentName}\n        </Space>\n      );\n    // {console.log(this.columns)}\n    return (\n      <Card title={title} extra={extra}>\n        <Table\n          rowKey=\"_id\"\n          pagination={{ pageSize: 5\n            // , total: 50 \n          }}\n          dataSource={parentId === \"0\" ? categorys : subCategorys}\n          columns={this.columns}\n          loading={this.state.loading}\n        />\n        <Modal\n          title=\"添加分类\"\n          visible={showStatus === 1}\n          onOk={this.addCategotry}\n          onCancel={this.handleCancel}\n          destroyOnClose={true}\n        >\n          <AddForm\n            categorys={categorys}\n            categoryName\n            setClasses={(classes) => {\n              this.classes = classes;\n            }}\n            setInput={(input) => {\n              this.input = input;\n            }}\n          />\n        </Modal>\n        <Modal\n          title=\"修改分类\"\n          visible={showStatus === 2}\n          onCancel={this.handleCancel}\n          destroyOnClose={true} //让对话框关闭时候清空输入值\n          onOk={this.updateCategory}\n        >\n          <UpdateForm\n            category={category.name}\n            setForm={(form) => {\n              this.form = form;\n            }}\n          />\n        </Modal>\n      </Card>\n    );\n  }\n}\n\nexport default withRouter(Category)"]},"metadata":{},"sourceType":"module"}